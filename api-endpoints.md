# API 接口

- [通用数据返回格式](#通用数据返回格式)
  - [状态码](#状态码)
- [用户管理](#用户管理)
  - [用户登录 <3.4.1>](#用户登录-341)
  - [用户退出登录 <3.4.1>](#用户退出登录-341)
  - [修改用户密码](#修改用户密码)
  - [获取所有用户信息【管理员】](#获取所有用户信息管理员)
  - [获取所有职务 <3.1>](#获取所有职务-31)
  - [获取所有权限 <3.1>](#获取所有权限-31)
  - [修改用户信息【管理员】 <3.3.2>](#修改用户信息管理员-332)
  - [增加新用户【管理员】 <3.3.1>](#增加新用户管理员-331)
  - [删除用户【管理员】 <3.3.3>](#删除用户管理员-333)
  - [导出用户信息 Excel 表【管理员】<3.2.3 (1)>](#导出用户信息-excel-表管理员323-1)
- [文物管理](#文物管理)
  - [获取所有文物状态](#获取所有文物状态)
  - [获取所有文物信息](#获取所有文物信息)
  - [创建文物（拍照上传）【拍照人员】 <3.2.1>](#创建文物拍照上传拍照人员-321)
  - [修改文物详细信息【文职员工】 <3.2.2/7>](#修改文物详细信息文职员工-3227)
  - [入馆后修改文物状态信息/盘点/移动【仓库管理员】 <3.2.4/5/6>](#入馆后修改文物状态信息盘点移动仓库管理员-32456)
  - [修改文物价值【资产科】 <3.2.9>](#修改文物价值资产科-329)
  - [导出文物一览 Excel 表【文职人员（无价值）、管理员】 <3.2.3 (2)>](#导出文物一览-excel-表文职人员无价值管理员-323-2)
  - [导出某仓库文物一览 Excel 表【仓库管理员、管理员】 <3.2.3 (3)>](#导出某仓库文物一览-excel-表仓库管理员管理员-323-3)
  - [导出文物流水 Excel 表【管理员】 <3.2.3 (4)>](#导出文物流水-excel-表管理员-323-4)
- [仓库管理](#仓库管理)
  - [获取所有仓库信息【仓库管理员】](#获取所有仓库信息仓库管理员)
  - [创建仓库【仓库管理员】](#创建仓库仓库管理员)
  - [修改仓库信息【仓库管理员】](#修改仓库信息仓库管理员)
  - [删除仓库【仓库管理员】](#删除仓库仓库管理员)
- [其他](#其他)
  - [获取所有数据库备份信息【管理员】](#获取所有数据库备份信息管理员)
  - [数据库备份【管理员】](#数据库备份管理员)
  - [数据库恢复【管理员】](#数据库恢复管理员)
  - [导出操作动态 Excel 表【管理员】 <3.2.3 (5)>](#导出操作动态-excel-表管理员-323-5)

---

## 通用数据返回格式

```json
{
    "code": 200, // 状态码
    "data": {}, // 返回对象
    "msg": "success" // 提示信息
}
```

### 状态码

| 状态码 | 含义     |
| ------ | -------- |
| 200    | 请求成功 |
| *TODO* | *TODO*   |

## 用户管理

TODO: 忘记密码

### 用户登录 <3.4.1>

`POST /api/v1/sessions`

#### 参数

```json
{
    "workId": 1, // 工号，必填
    "password": "string" // 密码（大概要加密？），必填
}
```

#### 返回值

```json
{
    "workId": 1, // 工号
    "name": "aaa", // 姓名
    "jobId": 1, // 职务ID
    "permissionId": [1, 2, 3] // 权限ID
}
```

#### 错误状态码

| 状态码 code | 含义 msg       |
| ----------- | -------------- |
| 10000       | 工号或密码错误 |

### 用户退出登录 <3.4.1>

`DELETE /api/v1/sessions`

#### 参数

无

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

无

### 修改用户密码

`PUT /api/v1/users/password`

#### 参数

```json
{
    "oldPassword": "abc", // 旧密码，必填
    "newPassword": "def" // 新密码，必填
}
```

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

| 状态码 code | 含义 msg |
| ----------- | -------- |
| 10000       | 密码错误 |

### 获取所有用户信息【管理员】

`GET /api/v1/users`

#### 参数

无

#### 返回值

```json
[
    {
        "id": 1, // 编号
        "workId": 1, // 工号
        "name": "aaa", // 姓名
        "jobId": 1, // 职务ID
        "permissionId": [1, 2, 3], // 权限ID
        "telephone": "13800138000" // 手机号
    }
]
```

#### 错误状态码

无

### 获取所有职务 <3.1>

`GET /api/v1/jobs`

#### 参数

无

#### 返回值

```json
[
    {
        "id": 1, // 编号
        "name": "job" // 职务名称
    }
]
```

| 职务编号 | 职务名称   |
| -------- | ---------- |
| 1        | 拍照人员   |
| 2        | 资产科     |
| 3        | 仓库管理员 |
| 4        | 文职人员   |
| 5        | 管理员     |

#### 错误状态码

无

### 获取所有权限 <3.1>

`GET /api/v1/permissions`

#### 参数

无

#### 返回值

```json
[
    {
        "id": 1, // 编号
        "name": "job" // 职务名称
    }
]
```

| 权限编号 | 权限名称 |
| -------- | -------- |
| *TODO*   | *TODO*   |

#### 错误状态码

无

### 修改用户信息【管理员】 <3.3.2>

`PUT /api/v1/users/{userId:int:用户编号}`

#### 参数

```json
[
    {
        "workId": 1, // 工号
        "name": "aaa", // 姓名
        "password": "abc", // 密码
        "jobId": 1, // 职务ID
        "permissionId": [1, 2, 3], // 权限ID
        "telephone": "13800138000" // 手机号
    }
]
```

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

| 状态码 code | 含义 msg |
| ----------- | -------- |
| 10001       | 工号重复 |

### 增加新用户【管理员】 <3.3.1>

`POST /api/v1/users`

#### 参数

```json
[
    {
        "workId": 1, // 工号
        "name": "aaa", // 姓名
        "password": "abc", // 密码
        "jobId": 1, // 职务ID
        "permissionId": [1, 2, 3], // 权限ID
        "telephone": "13800138000" // 手机号
    }
]
```

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

| 状态码 code | 含义 msg |
| ----------- | -------- |
| 10001       | 工号重复 |

### 删除用户【管理员】 <3.3.3>

`DELETE /api/v1/users/{userId:int:用户编号}`

#### 参数

无

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

| 状态码 code | 含义 msg   |
| ----------- | ---------- |
| 10002       | 用户不存在 |

### 导出用户信息 Excel 表【管理员】<3.2.3 (1)>

`GET /api/v1/users?excel={boolean}`

#### 参数

备注：鬼知道会不会改需求 就先加个excel字段了 反正不影响 下同 只有excel=true的时候才返回xlsx

| 字段名 | 字段类型 | 必填 | 含义                | 样例 |
| ------ | -------- | ---- | ------------------- | ---- |
| excel  | boolean  |      | 是否导出成 Excel 表 | true |

#### 返回值

```json
{
    "filePath": "//files/export/xxxxxxx.xlsx" // 文件地址
}
```

#### 错误状态码

无

## 文物管理

TODO: 盘点记录 盘点异常

### 获取所有文物状态

`GET /api/v1/relics/status`

#### 参数

无

#### 返回值

```json
[
    {
        "id": 1, // 编号
        "name": "待评估" // 状态名称
    }
]
```

| 状态编号 | 状态名称 |
| -------- | -------- |
| 1        | 待评估   |
| 2        | 在馆     |
| 3        | 外借     |
| 4        | 修理     |
| 5        | 离馆     |

#### 错误状态码

无

### 获取所有文物信息

`GET /api/v1/relics?name={string}&status={int}&page={int}&count={int}`

#### 参数

| 字段名 | 字段类型 | 必填 | 含义                                   | 样例 |
| ------ | -------- | ---- | -------------------------------------- | ---- |
| name   | string   |      | 按名字搜索                             | aaa  |
| status | int      |      | 按照文物状态id搜索（待录入就是待评估） | 1    |
| page   | int      | Y    | 页码                                   | 1    |
| count  | int      | Y    | 一次获取的个数（上限20）               | 20   |

#### 返回值

```json
[
    {
        "id": 1, // 文物编号
        "name": "wdnmd", // 文物名称
        "count": 2, // 数量
        "picturePath": "//files/relics/images/1.jpg", // 照片地址
        "year": "南北朝", // 年代
        "reign": "xxx", // 年号
        "type": "沙雕", // 器型
        "source": "xxx捐赠", // 来源
        "size": "11cm x 45cm x 14cm", // 尺寸
        "weight": 19198.10, // 重量 kg
        "warehouseId": 1, // 收储仓库id
        "place": "aaa", // 收储地点
        "enterPrice": "12345678.90", // 入馆价值【资产科】
        "leavePrice": "12345678.90", // 离馆价值【资产科】
        "statusId": 1, // 状态id
        "lastCheckTime": "2020-04-25 11:11:11", // 最后盘点时间【仓库管理员】
        "enterTime": "2020-04-25 11:11:11", // 入馆时间【仓库管理员】
        "leaveTime": "2020-04-25 11:11:11", // 离馆时间【仓库管理员】
        "moveTime": "2020-04-25 11:11:11", // 移入仓库时间【仓库管理员】
        "lendTime": "2020-04-25 11:11:11", // 出借时间【仓库管理员】
        "comment": "a" // 备注
    }
]
```

#### 错误状态码

无

### 创建文物（拍照上传）【拍照人员】 <3.2.1>

`POST /api/v1/relics`

#### 参数值

图片文件（jpg/png）

#### 返回值

```json
{
    "id": 1, // 文物编号
    "picturePath": "//files/relics/images/1.jpg" // 照片地址
}
```

#### 错误状态码

无

### 修改文物详细信息【文职员工】 <3.2.2/7>

`PUT /api/v1/relics/{relicId:int:文物编号}`

备注：文物状态只能由 “待评估” 修改为 “入馆”

#### 参数

```json
{
    "name": "wdnmd", // 文物名称
    "count": 2, // 数量
    "year": "南北朝", // 年代
    "reign": "xxx", // 年号
    "type": "沙雕", // 器型
    "source": "xxx捐赠", // 来源
    "size": "11cm x 45cm x 14cm", // 尺寸
    "weight": 19198.10, // 重量 kg
    "warehouseId": 1, // 收储仓库id
    "place": "aaa", // 收储地点
    "statusId": 1, // 状态id
    "comment": "a" // 备注
}
```

#### 返回值

```json
{
    "id": 1, // 文物编号
    "name": "wdnmd", // 文物名称
    "count": 2, // 数量
    "picturePath": "//files/relics/images/1.jpg", // 照片地址
    "year": "南北朝", // 年代
    "reign": "xxx", // 年号
    "type": "沙雕", // 器型
    "source": "xxx捐赠", // 来源
    "size": "11cm x 45cm x 14cm", // 尺寸
    "weight": 19198.10, // 重量 kg
    "warehouseId": 1, // 收储仓库id
    "place": "aaa", // 收储地点
    "enterPrice": "12345678.90", // 入馆价值【资产科】
    "leavePrice": "12345678.90", // 离馆价值【资产科】
    "statusId": 1, // 状态id
    "lastCheckTime": "2020-04-25 11:11:11", // 最后盘点时间【仓库管理员】
    "enterTime": "2020-04-25 11:11:11", // 入馆时间【仓库管理员】
    "leaveTime": "2020-04-25 11:11:11", // 离馆时间【仓库管理员】
    "moveTime": "2020-04-25 11:11:11", // 移入仓库时间【仓库管理员】
    "lendTime": "2020-04-25 11:11:11", // 出借时间【仓库管理员】
    "comment": "a" // 备注
}
```

#### 错误状态码

无

### 入馆后修改文物状态信息/盘点/移动【仓库管理员】 <3.2.4/5/6>

`PUT /api/v1/relics/{relicId:int:文物编号}`

TODO: 分离文物盘点接口

#### 参数

```json
{
    "name": "wdnmd", // 文物名称
    "count": 2, // 数量
    "year": "南北朝", // 年代
    "reign": "xxx", // 年号
    "type": "沙雕", // 器型
    "source": "xxx捐赠", // 来源
    "size": "11cm x 45cm x 14cm", // 尺寸
    "weight": 19198.10, // 重量 kg
    "warehouseId": 1, // 收储仓库id
    "place": "aaa", // 收储地点
    "statusId": 1, // 状态id
    "comment": "a" // 备注
}
```

#### 返回值

```json
{
    "id": 1, // 文物编号
    "name": "wdnmd", // 文物名称
    "count": 2, // 数量
    "picturePath": "//files/relics/images/1.jpg", // 照片地址
    "year": "南北朝", // 年代
    "reign": "xxx", // 年号
    "type": "沙雕", // 器型
    "source": "xxx捐赠", // 来源
    "size": "11cm x 45cm x 14cm", // 尺寸
    "weight": 19198.10, // 重量 kg
    "warehouseId": 1, // 收储仓库id
    "place": "aaa", // 收储地点
    "enterPrice": "12345678.90", // 入馆价值【资产科】
    "leavePrice": "12345678.90", // 离馆价值【资产科】
    "statusId": 1, // 状态id
    "lastCheckTime": "2020-04-25 11:11:11", // 最后盘点时间【仓库管理员】
    "enterTime": "2020-04-25 11:11:11", // 入馆时间【仓库管理员】
    "leaveTime": "2020-04-25 11:11:11", // 离馆时间【仓库管理员】
    "moveTime": "2020-04-25 11:11:11", // 移入仓库时间【仓库管理员】
    "lendTime": "2020-04-25 11:11:11", // 出借时间【仓库管理员】
    "comment": "a" // 备注
}
```

#### 错误状态码

无

### 修改文物价值【资产科】 <3.2.9>

`PUT /api/v1/relics/{relicId:int:文物编号}`

#### 参数

```json
{
    "enterPrice": "12345678.90", // 入馆价值【资产科】
    "leavePrice": "12345678.90" // 离馆价值【资产科】
}
```

#### 返回值

```json
{
    "id": 1, // 文物编号
    "name": "wdnmd", // 文物名称
    "count": 2, // 数量
    "picturePath": "//files/relics/images/1.jpg", // 照片地址
    "year": "南北朝", // 年代
    "reign": "xxx", // 年号
    "type": "沙雕", // 器型
    "source": "xxx捐赠", // 来源
    "size": "11cm x 45cm x 14cm", // 尺寸
    "weight": 19198.10, // 重量 kg
    "warehouseId": 1, // 收储仓库id
    "place": "aaa", // 收储地点
    "enterPrice": "12345678.90", // 入馆价值【资产科】
    "leavePrice": "12345678.90", // 离馆价值【资产科】
    "statusId": 1, // 状态id
    "lastCheckTime": "2020-04-25 11:11:11", // 最后盘点时间【仓库管理员】
    "enterTime": "2020-04-25 11:11:11", // 入馆时间【仓库管理员】
    "leaveTime": "2020-04-25 11:11:11", // 离馆时间【仓库管理员】
    "moveTime": "2020-04-25 11:11:11", // 移入仓库时间【仓库管理员】
    "lendTime": "2020-04-25 11:11:11", // 出借时间【仓库管理员】
    "comment": "a" // 备注
}
```

#### 错误状态码

无

### 导出文物一览 Excel 表【文职人员（无价值）、管理员】 <3.2.3 (2)>

`GET /api/v1/relics?excel={boolean}`

#### 参数

| 字段名 | 字段类型 | 必填 | 含义                | 样例 |
| ------ | -------- | ---- | ------------------- | ---- |
| excel  | boolean  |      | 是否导出成 Excel 表 | true |

#### 返回值

```json
{
    "filePath": "//files/export/xxxxxxx.xlsx" // 文件地址
}
```

#### 错误状态码

无

### 导出某仓库文物一览 Excel 表【仓库管理员、管理员】 <3.2.3 (3)>

`GET /api/v1/relics/?warehouseId={int}&excel={boolean}`

#### 参数

| 字段名      | 字段类型 | 必填 | 含义                | 样例 |
| ----------- | -------- | ---- | ------------------- | ---- |
| excel       | boolean  |      | 是否导出成 Excel 表 | true |
| warehouseId | int      | Y    | 仓库编号            | 1    |

#### 返回值

```json
{
    "filePath": "//files/export/xxxxxxx.xlsx" // 文件地址
}
```

#### 错误状态码

无

### 导出文物流水 Excel 表【管理员】 <3.2.3 (4)>

`GET /api/v1/relics/changes?excel={boolean}&from={datestring}&to={datestring}`

#### 参数

| 字段名 | 字段类型   | 必填 | 含义                | 样例       |
| ------ | ---------- | ---- | ------------------- | ---------- |
| excel  | boolean    |      | 是否导出成 Excel 表 | true       |
| from   | datestring |      | 开始时间            | 2020-04-25 |
| to     | datestring |      | 结束时间            | 2020-04-25 |

#### 返回值

```json
{
    "filePath": "//files/export/xxxxxxx.xlsx" // 文件地址
}
```

#### 错误状态码

无

## 仓库管理

### 获取所有仓库信息【仓库管理员】

`GET /api/v1/warehouses?name={string}&page={int}&count={int}`

#### 参数

| 字段名 | 字段类型 | 必填 | 含义                     | 样例 |
| ------ | -------- | ---- | ------------------------ | ---- |
| name   | string   |      | 按名字搜索               | aaa  |
| page   | int      | Y    | 页码                     | 1    |
| count  | int      | Y    | 一次获取的个数（上限20） | 20   |

#### 返回值

```json
{
    "id": 1, // 仓库编号
    "name": "aaa" // 仓库名称
}
```

#### 错误状态码

无

### 创建仓库【仓库管理员】

`POST /api/v1/warehouses`

#### 参数

```json
{
    "name": "aaa" // 仓库名称
}
```

#### 返回值

```json
{
    "id": 1, // 仓库编号
    "name": "aaa" // 仓库名称
}
```

#### 错误状态码

无

### 修改仓库信息【仓库管理员】

`PUT /api/v1/warehouses/{warehouseId:int:仓库编号}`

#### 参数

```json
{
    "name": "aaa" // 仓库名称
}
```

#### 返回值

```json
{
    "id": 1, // 仓库编号
    "name": "aaa" // 仓库名称
}
```

#### 错误状态码

无

### 删除仓库【仓库管理员】

`DELETE /api/v1/warehouses/{warehouseId:int:仓库编号}`

#### 参数

无

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

| 状态码 code | 含义 msg       |
| ----------- | -------------- |
| 10002       | 仓库内还有文物 |

## 其他

TODO: 数据库操作大概需要验证一下密码？

### 获取所有数据库备份信息【管理员】

`GET /api/v1/backups`

#### 参数

无

#### 返回值

```json
[
    {
        "id": 1, // 编号
        "createTime": "2020-04-25 11:22:33", // 创建时间
        // TODO: 或许还会加其他信息 比如文物个数啥的
    }
]
```

#### 错误状态码

无

### 数据库备份【管理员】

`POST /api/v1/backups`

#### 参数

无

#### 返回值

```json
{
    "id": 1, // 编号
    "createTime": "2020-04-25 11:22:33", // 创建时间
    // TODO: 或许还会加其他信息 比如文物个数啥的
}
```

#### 错误状态码

无

### 数据库恢复【管理员】

`GET /api/v1/backups/{backupId:int:备份编号}`

#### 参数

无

#### 返回值

```json
{
    "success": true // 是否成功
}
```

#### 错误状态码

无

### 导出操作动态 Excel 表【管理员】 <3.2.3 (5)>

`GET /api/v1/operations?excel={boolean}&from={datestring}&to={datestring}`

#### 参数

| 字段名 | 字段类型   | 必填 | 含义                | 样例       |
| ------ | ---------- | ---- | ------------------- | ---------- |
| excel  | boolean    |      | 是否导出成 Excel 表 | true       |
| from   | datestring |      | 开始时间            | 2020-04-25 |
| to     | datestring |      | 结束时间            | 2020-04-25 |

#### 返回值

```json
{
    "filePath": "//files/export/xxxxxxx.xlsx" // 文件地址
}
```

#### 错误状态码

无
